<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Anomuge - Profil</title>
    <link rel="stylesheet" href="../../style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <meta name="theme-color" content="#000000">
    <meta name="description" content="Buat postinganmu dan biarkan orang lain membalasnya secara
    anonim">
    <link rel="apple-touch-icon" sizes="180x180" href="../../assets/icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../assets/icon.png">
    <meta property="og:title" content="Anomuge - Profil">
    <meta property="og:description" content="Profil">
    <meta property="og:image" content="../../assets/icon.png">
    <link rel="manifest" href="../../manifest.json">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&display=swap');

        * {
            font-family: Arial, Helvetica, sans-serif;
        }

        /* chrome */
        ::-webkit-scrollbar {
            width: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background-color: #2f2f2f;
        }

        ::-webkit-scrollbar-track {
            background-color: transparent;
        }

        /* Firefox & Edge */

        * {
            scrollbar-color: #2f2f2f transparent;
            /* Warna thumb dan track */
        }

        ::selection {
            background-color: #5f5f5f;
        }







        #pc-navb,
        #mobile-navb {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 53px;
            font-size: 15px;
            justify-content: space-between;
            border-bottom: 0.5px solid rgb(47, 51, 54);
            align-items: center;
            padding: 0 25px 0 16px;
            background-color: black;
            display: flex;
            align-items: center;
            user-select: none;
            z-index: 5;
            color: #E7E9EA;
            will-change: transform;
        }

        #loading {
            display: none;

        }

        #settings {
            padding: 30px 0 10px 0;
            display: grid;
            place-items: center;
        }

        #username {
            background-color: #2a2a31;
            width: 70%;
            color: #E7E9EA;
            padding: 0 10px;
            max-width: 400px;
            height: 55px;
            font-size: 18px;
            border-radius: 6px;
            outline: none;
        }

        #bio {
            background-color: #2a2a31;
            width: 70%;
            color: #E7E9EA;
            padding: 10px;
            max-width: 400px;
            height: 200px;
            resize: none;
            margin-top: 20px;
            font-size: 18px;
            border-radius: 6px;
            outline: none;
        }

        #mobile-footer {
            display: none;
        }

        #data-container {
            flex-wrap: wrap;
        }

        .post-button {
            user-select: none !important;
            font-weight: 600;
            font-family: Arial, Helvetica, sans-serif;
        }

        .post-button:active {
            background-color: #0d6cab;
        }

        .bwhite {
            background-color: white;
        }

        .white {
            color: #E7E9EA;
        }

        .blue {
            color: #1D9BF0;
        }

        .bblue {
            background-color: #1D9BF0;
        }

        .announcement-container {
            padding: 0.1px;
            height: 25px;
        }

        .announcement {
            font-size: 14px;
            background-color: #1D9BF0;
            border-radius: 6px 0;
            padding: 2px;
            font-family: Arial, Helvetica, sans-serif;
            font-weight: 520;
        }

        .title {
            font-size: 23px;
            font-family: Poppins, Arial, Helvetica, sans-serif;
        }

        .ic-click:hover {
            background-color: rgb(61, 61, 61);
        }

        .ic-click {
            font-size: 24px;
            cursor: pointer;
            padding: 8px 9px;
            background-color: transparent;
            border-radius: 70%;
        }

        .ic-click:active {
            background-color: rgb(61, 61, 61);
        }

        #empty-data {
            margin-top: 12%;
        }

        .rounded-default {
            border-radius: 6px;
        }

        .desc {
            max-width: 350px;
        }

        .t-inf {
            font-size: 19px;

        }


        @media only screen and (max-width: 765px) {

            body {
                overflow: auto;
            }

            #main {
                min-height: 90vh;
                overflow: hidden;
                /*Firefox */
                scrollbar-width: thin;
                scrollbar-color: transparent transparent;

            }


            /* Chrome dan Safari */
            #main::-webkit-scrollbar {
                width: 0;
            }

            /* Firefox */
            #main::-moz-scrollbar {
                display: none;
            }

            #sidebar {
                display: none;
            }

            #data-container {
                justify-content: center;
                padding-bottom: 80px;
            }

            .button-list {
                justify-content: space-between;
                align-items: center;
                display: flex;
                width: 100%;
            }

            .mobile-page-button {
                color: #b5b5b5;
                display: grid;
                place-items: center;
                cursor: unset;
                height: 100%;
                padding: 13.5px 7px;
            }

            .mobile-page-icon {
                font-size: 23px;
            }

            .mobile-page-name {
                font-size: 15px;
                margin-top: 3px;
            }

            .mobile-is-here {
                color: #E7E9EA;
            }

            .card {
                width: 160px;
                background-color: #2a2a31;
                box-sizing: content-box;
                margin: 10px;
                border-radius: 6px;
                cursor: unset;
                user-select: none;
            }



            .card:active {
                background-color: #212127;
            }

            .card-icon {
                font-size: 40px;
                color: #E7E9EA;
            }


            #navb {
                padding: 2em 14px;
            }

            #save-container {
                display: flex;
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                height: 55px;
                border-top: 1px solid #2a2a31;
                user-select: none;
            }

            .ic-click {
                cursor: unset !important;
            }

            .post-button {
                user-select: none !important;
                font-weight: 600;
                font-family: Arial, Helvetica, sans-serif;
                cursor: unset !important;
            }

            .ic-click:hover {
                background-color: transparent;
            }

            .ic-click:active {
                background-color: rgb(61, 61, 61);
            }

            #pc-navb {
                display: none;
            }

            #mobile-navb {
                padding: 2em 14px;
                display: flex;
            }


            #mobile-footer {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                display: flex;
                height: 70px;
                background-color: black;
                will-change: transform;
                padding: 0 8%;
                border-top: 0.5px solid rgb(47, 51, 54);
                justify-content: space-between;
                align-items: center;
            }

            .savee-dis {
                color: #0d4d78;
                font-size: 17px;
                font-family: Arial, Helvetica, sans-serif;
                font-weight: 550;
                width: 50%;
                cursor: unset;
            }

            #cancel,
            .savee {
                color: #1D9BF0;
                font-size: 17px;
                font-family: Arial, Helvetica, sans-serif;
                font-weight: 550;
                width: 50%;
                cursor: unset;
            }

            #cancel {
                border-right: 0.3px solid #2a2a31;
            }

            .savee,
            .savee-dis {
                border-left: 0.3px solid #2a2a31;
            }

            #cancel:active,
            .savee:active {
                background-color: #021523;
            }

            /*popup */
            .popup {
                display: none;
                position: fixed;
                top: 50%;
                left: 50%;
                width: 50%;
                height: 17%;
                transform: translate(-50%, -50%);
                padding: 19px;
                background-color: rgb(42, 42, 42);
                box-shadow: 0 0 10px rgba(0, 0, 0, 0.4);
                border-radius: 6px;
                z-index: 15;
            }

            .backdrop {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.6);
                z-index: 10;
            }

            /* Loading */

            @keyframes rotate {
                from {
                    transform: rotate(0deg);
                }

                to {
                    transform: rotate(360deg);
                }
            }


            @-webkit-keyframes rotate {
                from {
                    -webkit-transform: rotate(0deg);
                }

                to {
                    -webkit-transform: rotate(360deg);
                }
            }

            .loading {
                width: 50px;
                height: 50px;
                border: solid 5px #E7E9EA;
                border-radius: 50%;
                border-right-color: transparent;
                border-bottom-color: transparent;
                -webkit-transition: all 0.5s ease-in;
                -webkit-animation-name: rotate;
                -webkit-animation-duration: 1.0s;
                -webkit-animation-iteration-count: infinite;
                -webkit-animation-timing-function: linear;

                transition: all 0.5s ease-in;
                animation-name: rotate;
                animation-duration: 1.0s;
                animation-iteration-count: infinite;
                animation-timing-function: linear;
            }

        }

        @media only screen and (min-width: 765px) {

            body {
                display: flex;
                overflow: hidden;

            }


            #main {
                height: 100vh;
                overflow: auto;
            }

            #mobile-navb {
                display: none;
            }

            #pc-navb {
                display: flex;
            }

            #mobile-footer {
                display: none;
            }




            #main {
                overflow: auto;
                scrollbar-width: thin;
                width: 100%;

            }

            #data-container {
                padding: 20px;
            }

            .card {
                width: 170px;
                background-color: #2a2a31;
                box-sizing: content-box;
                margin: 10px;
                border-radius: 6px;
                cursor: pointer;
                transition: transform 0.2s ease-in-out;
                user-select: none;
            }

            .card:hover {
                transform: scale(1.1);
            }

            .card:active {
                background-color: #212127;
            }

            .card-icon {
                font-size: 40px;
                color: #E7E9EA;
            }

            .end {
                width: 170px;
                height: 170px;
                background-color: transparent;
                box-sizing: content-box;
                margin: 10px;
                border-radius: 6px;
                cursor: pointer;
                transition: transform 0.2s ease-in-out;
                user-select: none;
            }

            #pc-navb {
                padding-left: 23px;
            }





            #sidebar {
                width: 17vw;
                height: 100vh;
                background-color: rgb(0, 0, 0);
                z-index: 1;
                border-right: 1px solid rgb(47, 51, 54);
                overflow-y: auto;
                padding-top: 81px;
                user-select: none;
            }


            #main {
                overflow: auto;
                scrollbar-width: thin;
                width: 100%;
                padding-top: 75px;

            }

            .save-dis {
                margin-top: 20px;
                width: 70%;
                max-width: 400px;
                padding: 10px 5px;
                border-radius: 6px;
                font-size: 20px;
                cursor: unset;
                font-weight: 600;
                font-family: Arial, Helvetica, sans-serif;
                background-color: #0d4d78;
            }

            .save {
                margin-top: 20px;
                width: 70%;
                max-width: 400px;
                padding: 10px 5px;
                border-radius: 6px;
                font-size: 20px;
                font-weight: 600;
                font-family: Arial, Helvetica, sans-serif;
                background-color: #1D9BF0;
            }

            .save:hover {
                background-color: #0d6cab;
            }

            .page-button {
                padding: 10px 13px;
                margin: 7px 12px;
                font-family: Arial, Helvetica, sans-serif;
                font-weight: 570;
                display: flex;
                align-items: center;
                font-size: 20px;
                cursor: pointer;
            }

            .is-here {
                background-color: #2a2a31;
                border-radius: 9px;
            }

            .page-button:hover {
                background-color: #1c1c20;
                border-radius: 9px;
            }

            .is-here:hover {
                background-color: #2a2a31;
            }

            .page-icon {
                font-size: 23px;
            }

            .page-name {
                margin-left: 20px;
            }

            #page-button-container {
                border-bottom: 0.2px solid rgb(47, 51, 54);
                padding: 0 0 10px 0;
            }

            #copyright {
                color: #717171;
                text-align: center;
                margin: 17px 0;
                font-size: 14px;
            }





            .post-button:hover {
                background-color: #0d6cab;
            }

            #save-container {
                display: none;
            }

            .popup {
                display: none;
                position: fixed;
                top: 50%;
                left: 50%;
                width: 24vw;
                height: 15vw;
                transform: translate(-50%, -50%);
                padding: 19px;
                background-color: rgb(42, 42, 42);
                box-shadow: 0 0 10px rgba(0, 0, 0, 0.4);
                border-radius: 7px;
                z-index: 15;
            }

            .backdrop {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.7);
                z-index: 10;
            }

            /* Loading */

            @keyframes rotate {
                from {
                    transform: rotate(0deg);
                }

                to {
                    transform: rotate(360deg);
                }
            }


            @-webkit-keyframes rotate {
                from {
                    -webkit-transform: rotate(0deg);
                }

                to {
                    -webkit-transform: rotate(360deg);
                }
            }

            .loading {
                width: 60px;
                height: 60px;
                border: solid 7px #E7E9EA;
                border-radius: 50%;
                border-right-color: transparent;
                border-bottom-color: transparent;
                -webkit-transition: all 0.5s ease-in;
                -webkit-animation-name: rotate;
                -webkit-animation-duration: 1.0s;
                -webkit-animation-iteration-count: infinite;
                -webkit-animation-timing-function: linear;

                transition: all 0.5s ease-in;
                animation-name: rotate;
                animation-duration: 1.0s;
                animation-iteration-count: infinite;
                animation-timing-function: linear;
            }

        }

        /* max width 1210 */
        @media screen and (max-width: 1210px) {
            #main {
                padding-top: 75px;
            }

            #sidebar {
                width: 77px;
            }

            #copyright {
                display: none;
            }

            .page-name {
                display: none;
            }

            .page-button {
                text-align: center;
                display: flex;
                justify-content: center;
            }
        }

        @media screen and (min-width: 1210px) {
            .page-icon {
                width: 29px;
            }
        }


        @media screen and (max-width: 360px) {
            .card {
                width: 140px;
            }

        }

        @media screen and (max-width: 326px) {
            .card {
                width: 90%;
            }
        }
    </style>
</head>

<body class="bg-black">
    <section id="sidebar">
        <ul id="page-button-container">
            <li>
                <a href="../../" class="page-button flex white" oncontextmenu="return false;">
                    <i class="page-icon fas fa-home"></i>
                    <p class="page-name">Beranda</p>
                </a>
            </li>
            <li>
                <a href="../../post" class="page-button flex white" oncontextmenu="return false;">
                    <i class="page-icon fas fa-pencil-alt"></i>
                    <p class="page-name">Posting</p>
                </a>
            </li>
            <li>
                <a href="../../profile" class="page-button flex white" oncontextmenu="return false;">
                    <i class="page-icon fas fa-user"></i>
                    <p class="page-name">Profil</p>
                </a>
            </li>
            <li>
                <a href="../../followed" class="page-button flex white" oncontextmenu="return false;">
                    <i class="page-icon fas fa-asterisk"></i>
                    <p class="page-name">Status</p>
                </a>
            </li>
            <li>
                <a href="../../messages" class="page-button flex white" oncontextmenu="return false;">
                    <i class="page-icon fas fa-comment"></i>
                    <p class="page-name">Pesan</p>
                </a>
            </li>
            <li>
                <a href="./" class="page-button flex white" oncontextmenu="return false;">
                    <i class="page-icon fas fa-info-circle"></i>
                    <p class="page-name">Tentang</p>
                </a>
            </li>
        </ul>
        <p id="copyright"></p>
    </section>

    <section id="main">
        <nav id="pc-navb" class="bg-black">
            <span>
                <h1 class="title white font-bold">Anomuge</h1>
            </span>
        </nav>
        <nav id="mobile-navb" class="bg-black">
            <span class="flex" style="align-items: center;">
                <i onclick="window.history.back()" class="ic-click fas fa-arrow-left text-xl"></i>
                <h1 style="margin-left: 5px;" id="sender-name" class="font-bold text-xl">Profil</h1>
            </span>
        </nav>
        <section style="display: none;" id="settings">
            <input type="text" name="username" id="username" placeholder="Username" autocomplete="off">
            <textarea name="bio" id="bio" placeholder="Bio"></textarea>
            <button id="save" class="save-dis" type="submut">Simpan</button>
        </section>

    </section>
    <footer id="save-container">
        <button onclick="window.history.length > 1 ? window.history.back() : window.location.replace('../');"
            id="cancel" type="submit">Batal</button>
        <button id="savee" class="savee-dis" type="submit">Simpan</button>
    </footer>
    <div style="display: none;" id="popup" class="popup">
        <div style="display: flex; justify-content: center; align-items: center; height: 100%; width: 100%;"
            class="loading-container">
            <div class="loading"></div>
        </div>
    </div>
    <div style="display: none;" id="backdrop" class="backdrop"></div>

    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('../../sw.js')
                .then((reg) => {
                    console.log(reg.scope);
                })
                .catch((error) => {
                    console.error(error);
                });
        }
    </script>

    <script>document.querySelector('html').setAttribute('lang', navigator.language || navigator.userLanguage);</script>

    <script type="text/javascript">

        if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone) {
            document.body.style.userSelect = "none";
        }

        const emptyData = document.getElementById("empty-data");
        const dataContainer = document.getElementById("data-container");
        const main = document.getElementById("main");
        const saveContainer = document.getElementById("save-container");
        const backdrop = document.getElementById("backdrop");
        const loadingPopup = document.getElementById("popup");
        const copyright = document.getElementById("copyright");
        copyright.innerText = `© ${new Date().getFullYear()} Wahyuna`;

        const settings = document.getElementById("settings");

        const username = document.getElementById("username");
        const bio = document.getElementById("bio");

        const save = document.getElementById("save");
        const savee = document.getElementById("savee");

        function show_loading() {
            loadingPopup.style.display = 'block';
            backdrop.style.display = 'block';
            document.body.classList.add('no-scroll');
        }

        function hide_loading() {
            loadingPopup.style.display = 'none';
            backdrop.style.display = 'none';
            document.body.classList.remove('no-scroll');
        }



        const chrt = (char, key) => /[a-zA-Z]/.test(char) ? String.fromCharCode((char.charCodeAt() - (/[A-Z]/.test(char) ? 65 : 97) + key + 26) % 26 + (/[A-Z]/.test(char) ? 65 : 97)) : char;
        const text_to_base64 = (text) => btoa(text);
        const base64_to_text = (base64) => atob(base64);
        const encrypt = (text, key) => text_to_base64([...text].map(char => chrt(char, key)).join(''));
        const decrypt = (text, key) => [...base64_to_text(text)].map(char => chrt(char, (26 - key) % 26)).join('');




        if (localStorage.getItem("_0_n")) {
            const ran = (length) => Array.from({ length }, () => 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'[(Math.random() * 62) | 0]).join('');




            let xhr = new XMLHttpRequest();
            xhr.open('POST', '../../check.php', true);
            xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    let output = JSON.parse(xhr.responseText);

                    if (output.success) {
                        settings.style.display = 'grid';

                        username.value = decrypt(output.username, 71).trim();
                        bio.value = output.bio.trim();

                        function input() {
                            if (username.value.length > 4 && bio.value.length > 4 && (username.value.trim() != decrypt(output.username, 71).trim() || bio.value.trim() != output.bio.trim())) {
                                // tombol aktif
                                save.classList.remove("save-dis");
                                save.classList.add("save");
                                savee.classList.remove("savee-dis");
                                savee.classList.add("savee");
                            } else {
                                // tombol mati
                                save.classList.remove("save");
                                save.classList.add("save-dis");
                                savee.classList.remove("savee");
                                savee.classList.add("savee-dis");
                            }
                        }

                        username.addEventListener("input", function () {
                            input();
                        })
                        bio.addEventListener("input", function () {
                            bio.value = bio.value.slice(0, 200);
                            input();
                        })





                        // post
                        function update(data, ping) {
                            const xhr = new XMLHttpRequest();
                            xhr.open('POST', "../../change_data.php", true);
                            xhr.setRequestHeader('Content-Type', 'application/json');

                            xhr.onreadystatechange = function () {
                                if (xhr.readyState === 4) {
                                    if (xhr.status === 200) {
                                        const resp = JSON.parse(xhr.responseText);
                                        ping(resp);
                                    } else {
                                        console.error(xhr.status);
                                    }
                                }
                            };

                            xhr.send(JSON.stringify(data));
                        }

                        function change_data() {

                            if (username.value.length > 4 && bio.value.length > 4 && (username.value.trim() != decrypt(output.username, 71).trim() || bio.value.trim() != output.bio.trim())) {
                                main.style.display = "none"
                                saveContainer.style.display = "none"
                                show_loading()
                                const data = {
                                    token: output.token,
                                    username: encrypt(username.value.trim(), 71),
                                    bio: bio.value.trim()
                                };

                                // console.log(data)
                                update(data, function (res) {
                                    if (res.success) {
                                        setTimeout(function () {
                                            window.location.replace('../');
                                        }, 90)
                                    } else {
                                        window.location.href = "../../";
                                    }
                                });
                            }
                        }


                        save.addEventListener('click', function () {
                            change_data()
                        })
                        savee.addEventListener('click', function () {
                            change_data()
                        })

                    } else {
                        // akun salah
                        window.location.replace("../../signin")
                    }
                }
            };

            // kirim
            xhr.send('token=' + encodeURIComponent(localStorage.getItem("_0_n")));
        } else {
            window.location.replace("../../signin")
        }
    </script>
</body>

</html>