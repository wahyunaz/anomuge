<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Anomuge</title>
    <link rel="stylesheet" href="./style.css">
    <meta name="theme-color" content="#000000">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <meta name="description" content="Buat postinganmu dan biarkan orang lain membalasnya secara
    anonim">
    <link rel="apple-touch-icon" sizes="180x180" href="./assets/icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./assets/icon.png">
    <meta property="og:title" content="Anomuge - Perpesanan anonim">
    <meta property="og:description" content="Buat postinganmu dan biarkan orang lain membalasnya secara
anonim">
    <meta property="og:image" content="./assets/icon.png">



    <link rel="manifest" href="./manifest.json">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&display=swap');

        * {
            font-family: Arial, Helvetica, sans-serif;
        }

        /* chrome */
        ::-webkit-scrollbar {
            width: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background-color: #2f2f2f;
        }

        ::-webkit-scrollbar-track {
            background-color: transparent;
        }



        /* Firefox & Edge */

        * {
            scrollbar-color: #2f2f2f transparent;
            /* Warna thumb dan track */
        }

        ::selection {
            background-color: #5f5f5f;
        }

        .paragraph {
            color: #afafaf;
        }

        .message-icon {
            width: 90px;
            margin-bottom: 12px;
            user-select: none;
        }

        #loading {
            display: block;
            height: 92vh;
        }

        .load_data {
            width: 45px;
            height: 45px;
            border: solid 4px #E7E9EA;
            border-radius: 50%;
            border-right-color: transparent;
            border-bottom-color: transparent;
            -webkit-transition: all 0.5s ease-in;
            -webkit-animation-name: rotate;
            -webkit-animation-duration: 1.0s;
            -webkit-animation-iteration-count: infinite;
            -webkit-animation-timing-function: linear;

            transition: all 0.5s ease-in;
            animation-name: rotate;
            animation-duration: 1.0s;
            animation-iteration-count: infinite;
            animation-timing-function: linear;
        }

        #navb {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 53px;
            font-size: 15px;
            display: flex;
            justify-content: space-between;
            border-bottom: 0.5px solid rgb(47, 51, 54);
            align-items: center;
            padding: 0 25px 0 16px;
            background-color: black;
            font-size: 15px;
            user-select: none;
            z-index: 5;
            color: #E7E9EA;
            will-change: transform;
        }

        #mobile-footer {
            display: none;
            user-select: none;
        }

        #data-container {
            flex-wrap: wrap;
        }

        .post-button {
            user-select: none !important;
            font-weight: 600;
            font-family: Arial, Helvetica, sans-serif;
        }

        .post-button:active {
            background-color: #0d6cab;
        }

        .bwhite {
            background-color: white;
        }

        .white {
            color: #E7E9EA;
        }

        .blue {
            color: #1D9BF0;
        }

        .bblue {
            background-color: #1D9BF0;
        }

        .announcement-container {
            padding: 0.1px;
            height: 25px;
        }

        .announcement {
            font-size: 14px;
            background-color: #1D9BF0;
            border-radius: 6px 0;
            padding: 2px;
            font-family: Arial, Helvetica, sans-serif;
            font-weight: 520;
        }

        .title {
            font-size: 23px;
            font-family: Poppins, Arial, Helvetica, sans-serif;
        }

        .ic-click:hover {
            background-color: rgb(61, 61, 61);
        }

        .ic-click {
            font-size: 24px;
            cursor: pointer;
            padding: 8px 9px;
            background-color: transparent;
            border-radius: 70%;
        }

        .ic-click:active {
            background-color: rgb(61, 61, 61);
        }

        #empty-data {
            margin-top: 12%;
        }

        .rounded-default {
            border-radius: 6px;
        }

        .desc {
            max-width: 350px;
        }

        .t-inf {
            font-size: 19px;

        }


        @media only screen and (max-width: 765px) {



            body {
                overflow: hidden;
            }

            #main {
                min-height: 90vh;
                overflow: hidden;
                /*Firefox */
                scrollbar-width: thin;
                scrollbar-color: transparent transparent;

            }

            /* Chrome dan Safari */
            #main::-webkit-scrollbar {
                width: 0;
            }

            /* Firefox */
            #main::-moz-scrollbar {
                display: none;
            }

            #sidebar {
                display: none;
            }

            #install {
                padding: 3px 6px;
                background-color: #1D9BF0;
                border-radius: 4px;
                margin-right: 7px;
                font-size: 16px;
                font-family: Arial, Helvetica, sans-serif;
                color: black;
                font-weight: 550;
            }

            #data-container {
                justify-content: center;
                padding-bottom: 80px;
            }

            #mobile-footer {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                display: flex;
                height: 59px;
                background-color: black;
                will-change: transform;
                padding: 0 8%;
                border-top: 0.5px solid rgb(47, 51, 54);
            }

            .button-list {
                justify-content: space-between;
                align-items: center;
                display: flex;
                width: 100%;
            }

            .mobile-page-button {
                color: #b5b5b5;
                display: grid;
                place-items: center;
                cursor: unset;
                height: 100%;
                padding: 13.5px 7px;
            }

            .mobile-page-icon {
                font-size: 19px;
            }

            .mobile-page-name {
                font-size: 11px;
                margin-top: 3px;
            }

            .mobile-is-here {
                color: #E7E9EA;
            }

            .card {
                width: 160px;
                background-color: #2a2a31;
                box-sizing: content-box;
                margin: 10px;
                border-radius: 6px;
                cursor: unset;
                user-select: none;
            }

            .end {
                .card {
                    width: 160px;
                    background-color: transparent;
                    height: 160px;
                    box-sizing: content-box;
                    margin: 10px;
                    border-radius: 6px;
                    cursor: unset;
                    user-select: none;
                }
            }


            .card:active {
                background-color: #212127;
            }

            .card-icon {
                font-size: 40px;
                color: #E7E9EA;
            }


            #navb {
                padding: 2em 14px;
            }

            .ic-click {
                cursor: unset !important;
            }

            .post-button {
                user-select: none !important;
                font-weight: 600;
                font-family: Arial, Helvetica, sans-serif;
                cursor: unset !important;
            }

            .ic-click:hover {
                background-color: transparent;
            }

            .ic-click:active {
                background-color: rgb(61, 61, 61);
            }

            @keyframes rotate {
                from {
                    transform: rotate(0deg);
                }

                to {
                    transform: rotate(360deg);
                }
            }


            @-webkit-keyframes rotate {
                from {
                    -webkit-transform: rotate(0deg);
                }

                to {
                    -webkit-transform: rotate(360deg);
                }
            }

            .loading {
                width: 50px;
                height: 50px;
                border: solid 5px #E7E9EA;
                border-radius: 50%;
                border-right-color: transparent;
                border-bottom-color: transparent;
                -webkit-transition: all 0.5s ease-in;
                -webkit-animation-name: rotate;
                -webkit-animation-duration: 1.0s;
                -webkit-animation-iteration-count: infinite;
                -webkit-animation-timing-function: linear;

                transition: all 0.5s ease-in;
                animation-name: rotate;
                animation-duration: 1.0s;
                animation-iteration-count: infinite;
                animation-timing-function: linear;
            }

            #load_data {
                display: none;
                justify-content: center;
                height: 170px;
            }

            /* end */
        }

        @media only screen and (min-width: 765px) {

            body {
                display: flex;
                overflow: hidden;

            }

            #main {
                height: 100vh;
                overflow: auto;
            }


            .about {
                display: none;
            }

            #mobile-footer {
                display: none;
            }


            #main {
                overflow: auto;
                scrollbar-width: thin;
                width: 100%;

            }

            #data-container {
                padding: 20px;
            }

            .card {
                width: 170px;
                background-color: #2a2a31;
                box-sizing: content-box;
                margin: 10px;
                border-radius: 6px;
                cursor: pointer;
                transition: transform 0.2s ease-in-out;
                user-select: none;
            }

            .card:hover {
                transform: scale(1.1);
            }

            .card:active {
                background-color: #212127;
            }

            .card-icon {
                font-size: 40px;
                color: #E7E9EA;
            }

            .end {
                width: 170px;
                height: 170px;
                background-color: transparent;
                box-sizing: content-box;
                margin: 10px;
                border-radius: 6px;
                cursor: pointer;
                transition: transform 0.2s ease-in-out;
                user-select: none;
            }




            #sidebar {
                width: 17vw;
                height: 100vh;
                background-color: rgb(0, 0, 0);
                z-index: 1;
                border-right: 1px solid rgb(47, 51, 54);
                overflow-y: auto;
                padding-top: 81px;
                user-select: none;
            }


            #main {
                overflow: auto;
                scrollbar-width: thin;
                width: 100%;
                padding-top: 75px;

            }

            #navb {
                padding-left: 23px;
            }

            .page-button {
                padding: 10px 13px;
                margin: 7px 12px;
                font-family: Arial, Helvetica, sans-serif;
                font-weight: 570;
                display: flex;
                align-items: center;
                font-size: 20px;
                cursor: pointer;
            }

            .is-here {
                background-color: #2a2a31;
                border-radius: 9px;
            }

            .page-button:hover {
                background-color: #1c1c20;
                border-radius: 9px;
            }

            .is-here:hover {
                background-color: #2a2a31;
            }

            .page-icon {
                font-size: 23px;
            }

            .page-name {
                margin-left: 20px;
            }

            #page-button-container {
                border-bottom: 0.2px solid rgb(47, 51, 54);
                padding: 0 0 10px 0;
            }

            #copyright {
                color: #717171;
                text-align: center;
                margin: 17px 0;
                font-size: 14px;
            }

            #install {
                padding: 3px 6px;
                background-color: #1D9BF0;
                border-radius: 4px;
                margin-right: 10px;
                font-size: 16px;
                font-family: Arial, Helvetica, sans-serif;
                color: black;
                font-weight: 550;
            }

            #install:hover {
                background-color: #0d6cab;
            }



            .post-button:hover {
                background-color: #0d6cab;
            }

            @keyframes rotate {
                from {
                    transform: rotate(0deg);
                }

                to {
                    transform: rotate(360deg);
                }
            }


            @-webkit-keyframes rotate {
                from {
                    -webkit-transform: rotate(0deg);
                }

                to {
                    -webkit-transform: rotate(360deg);
                }
            }



            .loading {
                width: 60px;
                height: 60px;
                border: solid 7px #E7E9EA;
                border-radius: 50%;
                border-right-color: transparent;
                border-bottom-color: transparent;
                -webkit-transition: all 0.5s ease-in;
                -webkit-animation-name: rotate;
                -webkit-animation-duration: 1.0s;
                -webkit-animation-iteration-count: infinite;
                -webkit-animation-timing-function: linear;

                transition: all 0.5s ease-in;
                animation-name: rotate;
                animation-duration: 1.0s;
                animation-iteration-count: infinite;
                animation-timing-function: linear;
            }

            #load_data {
                display: none;
                padding-top: 2.2vw;
                justify-content: center;
                height: 120px;
            }



        }

        /* max width 1210 */
        @media screen and (max-width: 1210px) {
            #main {
                padding-top: 75px;
            }

            #sidebar {
                width: 77px;
            }

            #copyright {
                display: none;
            }

            .page-name {
                display: none;
            }

            .page-button {
                text-align: center;
                display: flex;
                justify-content: center;
            }
        }

        @media screen and (min-width: 1210px) {
            .page-icon {
                width: 29px;
            }
        }


        @media screen and (max-width: 360px) {
            .card {
                width: 140px;
            }

            #install {
                display: none;
            }
        }

        @media screen and (max-width: 326px) {
            .card {
                width: 90%;
            }
        }
    </style>
</head>

<body style="background-color: black;">

    <section id="sidebar">
        <ul id="page-button-container">
            <li>
                <a href="./" class="page-button flex white is-here" oncontextmenu="return false;">
                    <i class="page-icon fas fa-home"></i>
                    <p class="page-name">Beranda</p>
                </a>
            </li>
            <li>
                <a href="./post" class="page-button flex white" oncontextmenu="return false;">
                    <i class="page-icon fas fa-pencil-alt"></i>
                    <p class="page-name">Posting</p>
                </a>
            </li>
            <li>
                <div onclick="window.location.href = `./profile/?n=@${decrypt(localStorage.getItem('rk_4t9'),71)}`"
                    class="page-button flex white" oncontextmenu="return false;">
                    <i class="page-icon fas fa-user"></i>
                    <p class="page-name">Profil</p>
                </div>
            </li>
            <li>
                <a href="./followed" class="page-button flex white" oncontextmenu="return false;">
                    <i class="page-icon fas fa-asterisk"></i>
                    <p class="page-name">Status</p>
                </a>
            </li>
            <li>
                <a href="./messages" class="page-button flex white" oncontextmenu="return false;">
                    <i class="page-icon fas fa-comment"></i>
                    <p class="page-name">Pesan</p>
                </a>
            </li>
            <li>
                <a href="./about" class="page-button flex white" oncontextmenu="return false;">
                    <i class="page-icon fas fa-info-circle"></i>
                    <p class="page-name">Tentang</p>
                </a>
            </li>
        </ul>
        <p id="copyright"></p>
    </section>

    <section id="main">
        <nav id="navb" class="flex bg-black">
            <span>
                <h1 class="title white font-bold">Anomuge</h1>
            </span>
            <span class="white" style="display: flex; align-items: center;">
                <button style="display: none;" type="submit" id="install">Apl</button>
                <i onclick="window.location.href='./post'" class="ic-click fas fa-plus"></i>
                <i onclick="window.location.href='./about'" class="about ic-click fas fa-info-circle"></i>
            </span>
        </nav>
        <section style="display: none;" id="data-container" class="flex flex-wrap">

        </section>
        <section id="load_data">
            <div class="load_data"></div>
        </section>
        <section id="loading">
            <div style="display: flex; justify-content: center; align-items: center; height: 80%; width: 100%;"
                class="loading-container">
                <div class="loading"></div>
            </div>
        </section>

        <section style="display: none;" id="empty-data" class="flex justify-center items-center select-none">
            <div class="inf inline-block text-center">
                <h1 class="font-bold white t-inf">Belum ada pesan</h1>
                <p class="paragraph desc m-5">Buat status anda sendiri dan biarkan orang lain membalasnya secara anonim
                </p>
                <button onclick="window.location.href = './post'" type="submit"
                    class="shadow post-button bblue px-4 py-2 rounded-default">Buat postingan</button>
            </div>

        </section>
    </section>
    <footer id="mobile-footer">
        <ul class="button-list">
            <li class="mobile-page-button mobile-is-here">
                <i class="mobile-page-icon fas fa-home"></i>
                <p class="mobile-page-name">Beranda</p>
            </li>
            <li onclick="window.location.href = './followed'" class="mobile-page-button">
                <i class="mobile-page-icon fas fa-asterisk"></i>
                <p class="mobile-page-name">Status</p>
            </li>
            <li onclick="window.location.href = './messages'" class="mobile-page-button">
                <i class="mobile-page-icon fas fa-comment"></i>
                <p class="mobile-page-name">Pesan</p>
            </li>
            <li onclick="window.location.href = `./profile/?n=@${decrypt(localStorage.getItem('rk_4t9'),71)}`"
                class="mobile-page-button">
                <i class="mobile-page-icon fas fa-user"></i>
                <p class="mobile-page-name">Profil</p>
            </li>
        </ul>
    </footer>



    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js')
                .then((reg) => {
                    console.log(reg.scope);
                })
                .catch((error) => {
                    console.error(error);
                });
        }



    </script>
    <script>
        navigator.language && (document.documentElement.lang = navigator.language)
    </script>
    <script>


        const install_button = document.getElementById('install');
        let prmpt;

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            prmpt = e;
            install_button.style.display = 'block';
        });

        function pwa() {
            if (prmpt) {
                prmpt.prompt();
                prmpt.userChoice
                    .then((result) => {
                        if (result.outcome === 'accepted') {
                            prmpt = null;
                            install_button.style.display = 'none';
                        } else {
                            install_button.style.display = 'none';
                        }
                    })
                    .catch((error) => {
                        console.error(error);
                    });
            }
        }

        install_button.addEventListener('click', pwa);


    </script>

    <script type="text/javascript">




        // if (window.innerWidth > 768) {
        //     document.addEventListener('contextmenu', function (e) {
        //         e.preventDefault();
        //     });
        // }



        const emptyData = document.getElementById("empty-data");
        const dataContainer = document.getElementById("data-container");
        const loading_section = document.getElementById("loading");
        const copyright = document.getElementById("copyright");
        copyright.innerText = `Â© ${new Date().getFullYear()} Wahyuna`;
        const load_data = document.getElementById("load_data");

        const chrt = (char, key) => /[a-zA-Z]/.test(char) ? String.fromCharCode((char.charCodeAt() - (/[A-Z]/.test(char) ? 65 : 97) + key + 26) % 26 + (/[A-Z]/.test(char) ? 65 : 97)) : char;
        const text_to_base64 = (text) => btoa(text);
        const base64_to_text = (base64) => atob(base64);
        const encrypt = (text, key) => text_to_base64([...text].map(char => chrt(char, key)).join(''));
        const decrypt = (text, key) => [...base64_to_text(text)].map(char => chrt(char, (26 - key) % 26)).join('');




        // timestamp

        const ago = timestamp => {
            const t = new Date() - new Date(timestamp);
            const s = Math.floor(t / 1000);
            const m = Math.floor(s / 60);
            const h = Math.floor(m / 60);
            const d = Math.floor(h / 24);
            const w = Math.floor(d / 7);
            const mn = Math.floor(w / 4);
            const y = Math.floor(mn / 12);

            return t < 1000 ? 'baru saja' : s < 60 ? `${s} detik` : m < 60 ? `${m} menit` : h < 24 ? `${h} jam` : d < 7 ? `${d} hari` : w < 4 ? `${w} minggu ` : mn < 12 ? `${mn} bulan` : `${y} tahun`;
        };


        function make_a_card(pseudonym, already_seen, time, post_id, read) {
            const card = document.createElement("div");
            card.classList.add('card', 'shadow');


            const announcementContainer = document.createElement("div");
            announcementContainer.setAttribute("class", "announcement-container flex");
            const announcement = document.createElement("p");
            announcement.setAttribute("class", "announcement")
            announcement.innerHTML = "New";
            if (!read) {
                announcementContainer.appendChild(announcement);
            }
            card.appendChild(announcementContainer);


            const iconContainer = document.createElement("div");
            iconContainer.innerHTML = '<img class="message-icon" src="assets/message.webp" alt="message" />';
            iconContainer.style.height = "85px";
            iconContainer.style.padding = "0 0 10px 0"
            iconContainer.style.width = '100%';
            iconContainer.style.display = 'flex';
            iconContainer.style.alignItems = 'center';
            iconContainer.style.justifyContent = 'center';
            iconContainer.style.borderBottom = '0.5px solid gray';
            card.appendChild(iconContainer);

            const pseudonymContainer = document.createElement('div');
            pseudonymContainer.style.display = 'flex';
            pseudonymContainer.style.alignItems = 'center';
            pseudonymContainer.style.justifyContent = 'space-between';
            pseudonymContainer.style.padding = '11px'

            const pseudonymParagraph = document.createElement('p');
            pseudonymParagraph.style.color = '#E7E9EA';
            pseudonymParagraph.style.fontFamily = 'Arial';
            const decpseudonym = decrypt(pseudonym, 71).trim();
            pseudonymParagraph.innerText = decpseudonym.length > 7
                ? decpseudonym.substring(0, 7).trim() + "..."
                : decpseudonym.trim();

            pseudonymContainer.appendChild(pseudonymParagraph);

            const timeParagraph = document.createElement('p');
            timeParagraph.style.color = 'gray';
            timeParagraph.style.fontFamily = 'Arial';
            timeParagraph.innerText = ago(time.trim());
            setInterval(function () {
                timeParagraph.innerText = ago(time.trim());
            }, 1000)
            pseudonymContainer.appendChild(timeParagraph);

            card.appendChild(pseudonymContainer);

            card.addEventListener("click", function () {

                window.location.href = "message/?id=" + post_id
                announcement.style.display = 'none';
            })

            dataContainer.appendChild(card);
        }



        //keamanan
        if (localStorage.getItem("_0_n")) {
            const ran = (length) => Array.from({ length }, () => 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'[(Math.random() * 62) | 0]).join('');




            let xhr = new XMLHttpRequest();
            xhr.open('POST', 'check.php', true);
            xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    let output = JSON.parse(xhr.responseText);

                    if (output.success) {

                        // jika berhasil
                        localStorage.setItem("_0_n", output.token)
                        localStorage.setItem('rk_4t9', output.username)
                        sessionStorage.setItem("9_r_5", ran(55))
                        if (output.anonymous_id.length > 0) {
                            localStorage.setItem('9_nn', output.anonymous_id)
                            if (output.pseudonym) {

                                localStorage.setItem('x_n', output.pseudonym)
                            }
                        } else if (localStorage.getItem("9_nn")) {


                            fetch('save_anonymous_data.php', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({
                                    token: output.token,
                                    anonymous_id: localStorage.getItem("9_nn") || "",
                                    pseudonym: localStorage.getItem("x_n") ? localStorage.getItem("x_n") : ""
                                }),
                            })
                                .then(ress => ress.json())
                                .then(datax => {
                                    true
                                })
                                .catch((error) => {
                                    console.error(error);
                                });
                        }

                        let start_index = 0;
                        let end_of_data = 0;

                        async function showData(si) {
                            try {
                                const dataa = new FormData();
                                dataa.append('id', output.id);
                                dataa.append('token', output.token);
                                dataa.append('start_index', si);

                                const res = await fetch('data.php', {
                                    method: 'POST',
                                    body: dataa,
                                    cache: 'no-store'
                                });

                                if (!res.ok) {
                                    throw new Error(res.status);
                                }

                                const results = await res.json();
                                start_index += 12;
                                end_of_data = results.end_index;

                                if (end_of_data > 0) {
                                    setTimeout(function () {

                                        emptyData.style.display = 'none';
                                        document.body.style.overflow = 'auto';
                                        loading_section.style.display = 'none';
                                        dataContainer.style.display = 'flex';
                                        load_data.style.display = 'flex';
                                    }, 50);

                                    results.data.forEach(data => {
                                        make_a_card(data.pseudonym, data.read, data.date, data.id, data.read);
                                    });
                                } else {
                                    setTimeout(function () {
                                        loading_section.style.display = 'none';
                                        document.body.style.overflow = 'auto';
                                        dataContainer.style.display = 'none';
                                        emptyData.style.display = 'flex';
                                        load_data.style.display = 'none';
                                    }, 50);
                                }
                            } catch (error) {
                                console.error(error);
                            }
                        }

                        let view_data = setInterval(() => {
                            if (start_index <= end_of_data) {
                                const rect = dataContainer.getBoundingClientRect();

                                if (rect.bottom <= window.innerHeight) {

                                    showData(start_index)
                                }
                            } else {
                                clearInterval(view_data);
                                setTimeout(function () {
                                    load_data.style.display = 'none';
                                }, 200);
                            }
                        }, 400);

                    } else {
                        // akun salah

                        window.location.replace("./signin")
                    }
                }
            };

            // send
            xhr.send('token=' + encodeURIComponent(localStorage.getItem("_0_n")));
        } else {
            window.location.replace("./signin")
        }

    </script>
</body>

</html>